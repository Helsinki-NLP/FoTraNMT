# Testing with 6 languages (total 18 language pairs)
# train_([a-z][a-z])-*\1  regex for matching only autoencoding tasks (and edit with multi-caret - thanks pycharm!)
save_data: /scratch/project_2005099/data/opus/opus06-vocabs
src_vocab:
  'en': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.en.vocab.onmt
  'ar': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.ar.vocab.onmt
  'fr': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.fr.vocab.onmt
  'zh': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.zh.vocab.onmt
  'de': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.de.vocab.onmt
  'nl': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.nl.vocab.onmt
  'ru': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.ru.vocab.onmt
tgt_vocab:
  'en': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.en.vocab.onmt
  'ar': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.ar.vocab.onmt
  'fr': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.fr.vocab.onmt
  'zh': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.zh.vocab.onmt
  'de': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.de.vocab.onmt
  'nl': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.nl.vocab.onmt
  'ru': /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/opusTC.ru.vocab.onmt

overwrite: False
data:
# GPU 0
  train_en-ar:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/ar-en/opus.ar-en-train.en.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/ar-en/opus.ar-en-train.ar.sp
    transforms: [filtertoolong]
  train_ar-en:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/ar-en/opus.ar-en-train.ar.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/ar-en/opus.ar-en-train.en.sp
    transforms: [filtertoolong]
  train_ar-ar:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/ar-en/opus.ar-en-train.ar.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/ar-en/opus.ar-en-train.ar.sp
    transforms: [filtertoolong, bart]

  train_en-fr:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-fr/opus.en-fr-train.en.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-fr/opus.en-fr-train.fr.sp
    transforms: [filtertoolong]
  train_fr-en:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-fr/opus.en-fr-train.fr.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-fr/opus.en-fr-train.en.sp
    transforms: [filtertoolong]
  train_fr-fr:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-fr/opus.en-fr-train.fr.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-fr/opus.en-fr-train.fr.sp
    transforms: [filtertoolong, bart]

  train_en-zh:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-zh/opus.en-zh-train.en.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-zh/opus.en-zh-train.zh.sp
    transforms: [filtertoolong]
  train_zh-en:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-zh/opus.en-zh-train.zh.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-zh/opus.en-zh-train.en.sp
    transforms: [filtertoolong]
  train_zh-zh:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-zh/opus.en-zh-train.zh.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-zh/opus.en-zh-train.zh.sp
    transforms: [filtertoolong, bart]

# GPU 1
  train_en-de:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/de-en/opus.de-en-train.en.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/de-en/opus.de-en-train.de.sp
    transforms: [filtertoolong]
  train_de-en:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/de-en/opus.de-en-train.de.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/de-en/opus.de-en-train.en.sp
    transforms: [filtertoolong]
  train_de-de:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/de-en/opus.de-en-train.de.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/de-en/opus.de-en-train.de.sp
    transforms: [filtertoolong, bart]

  train_en-nl:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-nl/opus.en-nl-train.en.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-nl/opus.en-nl-train.nl.sp
    transforms: [filtertoolong]
  train_nl-en:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-nl/opus.en-nl-train.nl.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-nl/opus.en-nl-train.en.sp
    transforms: [filtertoolong]
  train_nl-nl:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-nl/opus.en-nl-train.nl.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-nl/opus.en-nl-train.nl.sp
    transforms: [filtertoolong, bart]

  train_en-ru:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-ru/opus.en-ru-train.en.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-ru/opus.en-ru-train.ru.sp
    transforms: [filtertoolong]
  train_ru-en:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-ru/opus.en-ru-train.ru.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-ru/opus.en-ru-train.en.sp
    transforms: [filtertoolong]
  train_ru-ru:
    path_src: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-ru/opus.en-ru-train.ru.sp
    path_tgt: /scratch/project_2005099/data/opus/prepare_opus_data_tc_out/supervised/en-ru/opus.en-ru-train.ru.sp
    transforms: [filtertoolong, bart]

src_tgt: [
    "en-ar",
    "ar-en",
    "ar-ar",
    "en-fr",
    "fr-en",
    "fr-fr",
    "en-zh",
    "zh-en",
    "zh-zh",
    "en-de",
    "de-en",
    "de-de",
    "en-nl",
    "nl-en",
    "nl-nl",
    "en-ru",
    "ru-en",
    "ru-ru"
]

# opus06, 1 node 2 gpus
node_gpu: [
    "0:0", "0:0", "0:0", "0:0", "0:0", "0:0", "0:0", "0:0", "0:0",
    "0:1", "0:1", "0:1", "0:1", "0:1", "0:1", "0:1", "0:1", "0:1"
]

### Transform related opts:
#### Filter
src_seq_length: 200
tgt_seq_length: 200
#### Bart
src_subword_type: sentencepiece
tgt_subword_type: sentencepiece
mask_ratio: 0.2
replace_length: 1

# silently ignore empty lines in the data
skip_empty_level: silent

batch_size: 4096
batch_type: tokens
normalization: tokens
valid_batch_size: 4096
max_generator_batches: 2
src_vocab_size: 100000
tgt_vocab_size: 100000
encoder_type: transformer
decoder_type: transformer
rnn_size: 512
word_vec_size: 512
transformer_ff: 2048
heads: 8
dropout: 0.1
label_smoothing: 0.1
param_init: 0.0
param_init_glorot: true
position_encoding: true
valid_steps: 500000
#valid_steps: 100
warmup_steps: 10000
#warmup_steps: 40
report_every: 50
#report_every: 5
save_checkpoint_steps: 25000
keep_checkpoint: 3
accum_count: 1
optim: adafactor
decay_method: none
learning_rate: 3.0
max_grad_norm: 0.0
seed: 3435
model_type: text
save_all_gpus: true

world_size: 2
gpu_ranks: [0, 1]
